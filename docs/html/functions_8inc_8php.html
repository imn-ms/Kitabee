<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kitabee: include/functions.inc.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Kitabee
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('functions_8inc_8php.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">functions.inc.php File Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c66f3a44b52e154572337f7b707085d" id="r_a3c66f3a44b52e154572337f7b707085d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c66f3a44b52e154572337f7b707085d">kb_ensure_session_started</a> ()</td></tr>
<tr class="memitem:a6eb662ac89f0864d0a0308bd9da89021" id="r_a6eb662ac89f0864d0a0308bd9da89021"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6eb662ac89f0864d0a0308bd9da89021">kb_get_logged_user_from_session</a> ()</td></tr>
<tr class="memitem:a46466e82ae60197d887000ebfcf58fa8" id="r_a46466e82ae60197d887000ebfcf58fa8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46466e82ae60197d887000ebfcf58fa8">kb_allow_non_essential_cookies</a> ()</td></tr>
<tr class="memitem:a2456647f250fd8e5f13c9951e2a6d50e" id="r_a2456647f250fd8e5f13c9951e2a6d50e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2456647f250fd8e5f13c9951e2a6d50e">kb_get_logged_has_avatar</a> (?PDO $pdo, ?int $loggedUserId)</td></tr>
<tr class="memitem:a2cacb8629fc207f9c5636049d6c4e711" id="r_a2cacb8629fc207f9c5636049d6c4e711"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2cacb8629fc207f9c5636049d6c4e711">kb_get_pending_friend_requests</a> (?PDO $pdo, ?int $loggedUserId, int $pendingFriendRequests=0)</td></tr>
<tr class="memitem:a91e16f2d2bf74fc4096cbb9c04271437" id="r_a91e16f2d2bf74fc4096cbb9c04271437"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91e16f2d2bf74fc4096cbb9c04271437">kb_get_pending_club_notifications</a> (?PDO $pdo, ?int $loggedUserId)</td></tr>
<tr class="memitem:a5bec22e721208dd4840b3c62eb81000c" id="r_a5bec22e721208dd4840b3c62eb81000c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5bec22e721208dd4840b3c62eb81000c">kb_get_total_notifications</a> (int $pendingFriendRequests, int $pendingClubInvites, int $pendingClubMessages)</td></tr>
<tr class="memitem:a2babe6c8d6d33fb668757af157dc0b0c" id="r_a2babe6c8d6d33fb668757af157dc0b0c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2babe6c8d6d33fb668757af157dc0b0c">kb_get_current_style</a> ()</td></tr>
<tr class="memitem:a1785699b363dcc64f09c95c70fadc299" id="r_a1785699b363dcc64f09c95c70fadc299"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1785699b363dcc64f09c95c70fadc299">kb_is_post_toggle_style</a> ()</td></tr>
<tr class="memitem:a94bb27f0b93cb26b22a4107882ec2872" id="r_a94bb27f0b93cb26b22a4107882ec2872"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a94bb27f0b93cb26b22a4107882ec2872">kb_handle_style_toggle</a> (string $style, bool $allowNonEssential)</td></tr>
<tr class="memitem:a4fd21503bf97fbd3368faf9e9863a0e6" id="r_a4fd21503bf97fbd3368faf9e9863a0e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fd21503bf97fbd3368faf9e9863a0e6">kb_get_and_update_last_visit</a> (bool $allowNonEssential)</td></tr>
<tr class="memitem:a8ebf4bdde470f5bdc5acb3a8401b5115" id="r_a8ebf4bdde470f5bdc5acb3a8401b5115"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ebf4bdde470f5bdc5acb3a8401b5115">kb_header_bootstrap</a> (?PDO $pdo, ?int $pendingFriendRequests=null)</td></tr>
<tr class="memitem:a03bde29aed0c9f52d6ff1a987e796c4b" id="r_a03bde29aed0c9f52d6ff1a987e796c4b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a03bde29aed0c9f52d6ff1a987e796c4b">kb_activate_user_account</a> (PDO $pdo, string $token)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a03bde29aed0c9f52d6ff1a987e796c4b" name="a03bde29aed0c9f52d6ff1a987e796c4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03bde29aed0c9f52d6ff1a987e796c4b">&#9670;&#160;</a></span>kb_activate_user_account()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_activate_user_account </td>
          <td>(</td>
          <td class="paramtype">PDO</td>          <td class="paramname"><span class="paramname"><em>$pdo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$token</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Active un compte utilisateur à partir d’un token d’activation.</p>
<p>Cette fonction :</p><ul>
<li>vérifie la validité du token,</li>
<li>vérifie que le compte n’est pas déjà activé,</li>
<li>active le compte si possible,</li>
<li>retourne un message de succès ou d’erreur.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO à la base de données. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>Token d’activation reçu par URL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ success: bool, message: string, error: string } </dd></dl>
<p>Ajoute un livre à la wishlist de l’utilisateur à partir de son Google Book ID.</p>
<p>Étapes effectuées :</p><ul>
<li>vérifie la validité du book ID,</li>
<li>supprime le livre de la bibliothèque si présent (un livre ne peut pas être à la fois "lu" et "à lire"),</li>
<li>récupère les informations du livre via l’API Google Books,</li>
<li>insère le livre dans la table user_wishlist,</li>
<li>déclenche la vérification des badges.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO à la base de données. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>Identifiant de l’utilisateur connecté. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$bookId</td><td>Identifiant Google Books du livre. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$apiKey</td><td>Clé API Google Books</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ success: bool, bookId: string }</dd></dl>
<p>Prépare le contexte de la page <a class="el" href="amis_8php.html">amis.php</a> (traitements + données d’affichage).</p>
<p>Cette fonction :</p><ul>
<li>traite les actions POST (send_request, accept_request, reject_request, remove_friend),</li>
<li>exécute la recherche utilisateur via GET,</li>
<li>récupère les demandes reçues,</li>
<li>récupère la liste d’amis,</li>
<li>déclenche la vérification des badges (FRIEND_1, FRIEND_5, etc.).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>Identifiant de l’utilisateur connecté. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$request</td><td>Tableau request global</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ message: string|null, error: string|null, searchTerm: string, searchResults: array, incomingRequests: array, friends: array }</dd></dl>
<p>Envoie l’avatar d’un utilisateur (image ou fallback SVG).</p>
<p>Règles : 1) Si avatar_choice est défini et autorisé -&gt; renvoie le fichier /avatar/&lt;choice&gt;.(jpg/jpeg/JPG) 2) Sinon -&gt; renvoie un SVG avec l’initiale du login</p>
<p>Cette fonction gère :</p><ul>
<li>les codes HTTP (400/404),</li>
<li>le Content-Type correct (image/jpeg ou image/svg+xml),</li>
<li>la sortie directe (readfile / echo) et exit.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>Identifiant de l’utilisateur. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Récupère les livres de la bibliothèque (lus) et de la wishlist (à lire) pour un utilisateur.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>Identifiant de l’utilisateur.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ library: array&lt;int, array{google_book_id:string, title:?string, authors:?string, thumbnail:?string}&gt;, wishlist: array&lt;int, array{google_book_id:string, title:?string, authors:?string, thumbnail:?string}&gt; }</dd></dl>
<p>Construit le contexte du mode "liste" de <a class="el" href="club_8php.html">club.php</a> Gère :</p><ul>
<li>messages (left/deleted),</li>
<li>traitement des invitations (accept/decline),</li>
<li>création de club,</li>
<li>récupération invitations + clubs + messages non lus par club.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td></td></tr>
    <tr><td class="paramtype"><a class="el" href="class_club_manager.html">ClubManager</a></td><td class="paramname">$cm</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ pageTitle: string, message: string|null, error: string|null, clubInvites: array, clubs: array, unreadClubMessagesByClub: array&lt;int,int&gt; }</dd></dl>
<p>Construit le contexte du mode "détail" de <a class="el" href="club_8php.html">club.php</a> Gère :</p><ul>
<li>suppression du club (owner),</li>
<li>quitter le club,</li>
<li>envoi de message + notifications,</li>
<li>comptage / marquage des notifs "club_message" comme lues,</li>
<li>récupération club + membres + amis invitables + livres + bibliothèque perso + messages.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$clubId</td><td></td></tr>
    <tr><td class="paramtype"><a class="el" href="class_club_manager.html">ClubManager</a></td><td class="paramname">$cm</td><td></td></tr>
    <tr><td class="paramtype"><a class="el" href="class_friend_manager.html">FriendManager</a></td><td class="paramname">$fm</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ redirect: string|null, pageTitle: string, club: array|null, deleteError: string|null, leaveError: string|null, messageError: string|null, unreadMessagesThisClub: int, members: array, memberIds: array, memberCount: int, friends: array, invitableFriends: array, clubBooks: array, clubBooksCount: int, userLibrary: array, messages: array }</dd></dl>
<p>Gère les actions AJAX liées aux clubs de lecture.</p>
<p>Actions supportées (POST):</p><ul>
<li>add_member : crée une notification d’invitation (club_invite) (owner uniquement)</li>
<li>remove_member : retire un membre (owner uniquement)</li>
<li>add_book : ajoute un livre au club (google_book_id)</li>
<li>remove_book : retire un livre du club (google_book_id)</li>
</ul>
<p>Format retour:</p><ul>
<li>['ok' =&gt; true] en cas de succès</li>
<li>['ok' =&gt; false, 'error' =&gt; '...'] en cas d’erreur</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID de l’utilisateur courant. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$post</td><td>Tableau de données POST.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ok:bool, error?:string}</dd></dl>
<p>Traite le formulaire de connexion avec reCAPTCHA + vérification BD.</p>
<ul>
<li>Vérifie les champs (login, password)</li>
<li>Vérifie reCAPTCHA côté serveur (siteverify)</li>
<li>Vérifie l'utilisateur en base (password_hash, is_active)</li>
<li>Initialise la session : user, login, avatar_has</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$config</td><td>Tableau contenant au minimum les constantes reCAPTCHA </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$post</td><td>Données POST (ex: $_POST). </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$get</td><td>Données GET (ex: $_GET) pour redirect/reset. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$server</td><td>Données serveur (ex: $_SERVER) pour remote IP.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ error: string|null, success: string|null, redirect: string|null }</dd></dl>
<p>Prépare le contexte d'une page "En construction".</p>
<p>Cette fonction :</p><ul>
<li>Récupère le paramètre GET "page"</li>
<li>Détermine un titre lisible selon la page demandée</li>
<li>Génère le titre HTML complet pour le header</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$get</td><td>Tableau des paramètres GET</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ page: string, title: string, pageTitle: string }</dd></dl>
<p>Traite le formulaire de contact (validation + reCAPTCHA + envoi mail).</p>
<ul>
<li>Valide les champs obligatoires (nom, email, message)</li>
<li>Valide le format email</li>
<li>Vérifie reCAPTCHA v2 côté serveur (siteverify)</li>
<li>Envoie un mail via mail()</li>
<li>Retourne le contexte (success/error + valeurs de champs)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$post</td><td>Données POST </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$server</td><td>Données serveur pour IP + REQUEST_METHOD.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ success: string|null, error: string|null, nom: string, email: string, sujet: string, message: string }</dd></dl>
<p>Récupère l'état des cookies liés à la navigation et au consentement.</p>
<p>Cette fonction permet de centraliser :</p><ul>
<li>la présence du cookie de session "visited"</li>
<li>le consentement aux cookies non essentiels</li>
<li>les cookies persistants affichables (style, dernière visite)</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>array{ visited: bool, consent: string|null, style: string|null, last_visit: string|null }</dd></dl>
<p>Exécute les tâches automatiques de maintenance Kitabee (cron).</p>
<p>Tâches : 1) Supprimer les messages de clubs de +24h 2) Supprimer les comptes non activés depuis +24h 3) Supprimer les fichiers temporaires de +24h 4) Nettoyer les tokens de reset expirés</p>
<p>Retour :</p><ul>
<li>Un tableau de lignes de log (strings) prêt à être affiché.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$tmpPath</td><td>Chemin absolu du dossier tmp</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string[] Liste des logs.</dd></dl>
<p>Récupère les données nécessaires au tableau de bord utilisateur.</p>
<p>Cette fonction centralise :</p><ul>
<li>la liste des badges de l'utilisateur</li>
<li>le nombre de demandes d'amis en attente</li>
<li>le nombre d'invitations de clubs non lues</li>
<li>le nombre total de messages de clubs non lus</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID de l'utilisateur connecté.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ userBadges: array, pendingFriendRequests: int, pendingClubInvites: int, unreadClubMessagesTotal: int }</dd></dl>
<p>Déconnecte proprement l'utilisateur courant.</p>
<p>Cette fonction :</p><ul>
<li>vide les données de session</li>
<li>supprime le cookie de session si présent</li>
<li>détruit la session PHP</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Prépare les données de la page <a class="el" href="detail_8php.html">detail.php</a> (détail d'un livre).</p>
<ul>
<li>Récupère le livre via l'API Google Books (volume par ID).</li>
<li>Détermine si le livre est dans la wishlist / bibliothèque de l'utilisateur.</li>
<li>Gère l'enregistrement d'une note/commentaire personnel (si POST + livre en bibliothèque).</li>
<li>Récupère la note/commentaire perso et les statistiques globales (moyenne + nb avis).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$googleBookId</td><td>ID Google Books (volume ID). </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$loggedUserId</td><td>ID utilisateur connecté (0 si non connecté). </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$googleApiKey</td><td>Clé Google Books API (peut être null/empty).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ ok: bool, error?: string, book?: array, info?: array, title?: string, authors?: string, description?: string, thumbnail?: string, publisher?: string, publishedDate?: string, pageCount?: string|int, categories?: string, isInWishlist?: bool, isInLibrary?: bool, personalRating?: ?int, personalComment?: string, avgRating?: ?float, avgCount?: int }</dd></dl>
<p>Traite une requête AJAX JSON pour la gestion des amis (<a class="el" href="class_friend_manager.html">FriendManager</a>).</p>
<p>Cette fonction :</p><ul>
<li>vérifie que l'utilisateur est authentifié (session),</li>
<li>exécute l'action demandée (send/accept/decline/remove),</li>
<li>renvoie un tableau prêt à être encodé en JSON.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Connexion PDO.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ok: bool, error?: string}</dd></dl>
<p>Récupère une liste de livres depuis l'API Google Books.</p>
<p>Cette fonction construit l'URL de recherche Google Books, exécute l'appel HTTP et retourne la liste des items (volumes) si disponible.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>Requête Google Books. </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$apiKey</td><td>Clé API Google (optionnelle). Si null/vide, l'appel se fait sans clé. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$maxResults</td><td>Nombre de résultats (max 40 côté Google Books, souvent 10/20/40). </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$startIndex</td><td>Index de départ (pagination). </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$lang</td><td>Filtre de langue.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Liste des items Google Books. Vide si erreur/aucun résultat.</dd></dl>
<p>Vérifie la robustesse d'un mot de passe.</p>
<p>Règles :</p><ul>
<li>longueur &gt;= 6</li>
<li>au moins 1 majuscule</li>
<li>au moins 1 minuscule</li>
<li>au moins 1 chiffre</li>
<li>au moins 1 caractère spécial</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$pwd</td><td>Mot de passe à vérifier. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True si le mot de passe respecte les règles, sinon false.</dd></dl>
<p>Récupère la réponse brute de l'API Google Books.</p>
<p>Cette fonction effectue une requête vers l'API Google Books et retourne le JSON décodé complet.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>Terme de recherche (titre, auteur, ISBN, etc.). </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$apiKey</td><td>Clé API Google Books (optionnelle). </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$maxResults</td><td>Nombre max de résultats (1 à 40).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array|null Réponse JSON complète décodée ou null en cas d’échec.</dd></dl>
<p>Déplace un livre de la wishlist vers la bibliothèque de l'utilisateur.</p>
<p>Étapes :</p><ul>
<li>Récupère les informations du livre depuis la wishlist.</li>
<li>Supprime le livre de la wishlist.</li>
<li>Ajoute le livre dans la bibliothèque (user_library).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>Identifiant de l'utilisateur. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$bookId</td><td>Identifiant Google Books du livre.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True si le déplacement a réussi, false sinon.</dd></dl>
<p>Lance une procédure "mot de passe oublié" :</p><ul>
<li>Vérifie l'existence de l'utilisateur via l'e-mail.</li>
<li>Génère un token de réinitialisation + date d'expiration (1h).</li>
<li>Stocke ces informations en base.</li>
<li>Construit un lien de reset et envoie un email.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>Adresse e-mail saisie. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$siteBaseUrl</td><td>Base URL du site. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$mailFrom</td><td>Adresse utilisée dans l'en-tête From.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Tableau contenant :<ul>
<li>'ok' (bool)</li>
<li>'message' (string|null)</li>
<li>'error' (string|null)</li>
</ul>
</dd></dl>
<p>Traite la page "profil utilisateur" (lecture + update + suppression).</p>
<p>Rôle :</p><ul>
<li>Récupère l'utilisateur courant (login, email, avatar_choice, password).</li>
<li>Si POST delete_account : vérifie le mot de passe puis supprime le compte + détruit la session.</li>
<li>Si POST update : valide login/email uniques, gère avatar_choice, optionnellement change le mot de passe.</li>
<li>Met à jour la session (login + avatar_has).</li>
<li>Déclenche le check des badges (<a class="el" href="class_badge_manager.html">BadgeManager</a>) si mise à jour OK.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID utilisateur connecté.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ ok: bool, user: array|null, message: string|null, error: string|null, hasAvatar: bool, avatarUrl: string|null, redirect: string|null }</dd></dl>
<p>Vérifie la robustesse du mot de passe :</p><ul>
<li>longueur &gt;= 6</li>
<li>au moins 1 majuscule</li>
<li>au moins 1 minuscule</li>
<li>au moins 1 chiffre</li>
<li>au moins 1 caractère spécial</li>
</ul>
<p>Prépare les données de la page recommandations (variants + émotions + appels au service).</p>
<p>Rôle :</p><ul>
<li>Récupère l'action du POST et l'émotion sélectionnée.</li>
<li>Maintient ou régénère les "variants" pour varier les recommandations.</li>
<li>Instancie <a class="el" href="class_recommendation_service.html">RecommendationService</a> puis récupère :<ul>
<li>recommandations par genres</li>
<li>recommandations par auteurs</li>
<li>recommandations par émotion</li>
</ul>
</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID utilisateur connecté. </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$apiKey</td><td>Clé Google Books.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{ action: string|null, selectedEmotion: string|null, variantGenres: int, variantAuthors: int, variantEmotion: int, recoGenres: array, recoAuthors: array, recoEmotion: array }</dd></dl>
<p>Affiche une carte HTML "Google Book" (item Google Books API).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$item</td><td>Item (volume) Google Books. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Supprime un livre de la bibliothèque d'un utilisateur.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID de l'utilisateur connecté. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$bookId</td><td>Google Book ID du livre à supprimer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True si la requête s'est exécutée, false sinon.</dd></dl>
<p>Supprime un livre de la wishlist d'un utilisateur.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userId</td><td>ID de l'utilisateur connecté. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$bookId</td><td>Google Book ID du livre à supprimer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True si la requête s'est exécutée, false sinon.</dd></dl>
<p>Réinitialise le mot de passe d'un utilisateur via un token valide.</p>
<p>Rôle :</p><ul>
<li>Vérifie que le token existe et n'est pas expiré.</li>
<li>Met à jour le mot de passe.</li>
<li>Supprime le token et sa date d'expiration.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>Token de réinitialisation. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$password</td><td>Nouveau mot de passe en clair.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True si la réinitialisation a réussi, false sinon.</dd></dl>
<p>Crée un compte utilisateur en base de données.</p>
<p>Rôle :</p><ul>
<li>Valide les champs (login, email, password).</li>
<li>Vérifie l'unicité du login et de l'email.</li>
<li>Hash le mot de passe.</li>
<li>Insère l'utilisateur en base.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO</td><td class="paramname">$pdo</td><td>Instance PDO. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$login</td><td>Identifiant utilisateur. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>Adresse email. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$password</td><td>Mot de passe en clair.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Résultat standardisé :<ul>
<li>ok (bool)</li>
<li>message (string) message utilisateur</li>
</ul>
</dd></dl>

</div>
</div>
<a id="a46466e82ae60197d887000ebfcf58fa8" name="a46466e82ae60197d887000ebfcf58fa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46466e82ae60197d887000ebfcf58fa8">&#9670;&#160;</a></span>kb_allow_non_essential_cookies()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_allow_non_essential_cookies </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Indique si l'utilisateur a accepté les cookies non essentiels.</p>
<dl class="section return"><dt>Returns</dt><dd>bool </dd></dl>

</div>
</div>
<a id="a3c66f3a44b52e154572337f7b707085d" name="a3c66f3a44b52e154572337f7b707085d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c66f3a44b52e154572337f7b707085d">&#9670;&#160;</a></span>kb_ensure_session_started()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_ensure_session_started </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>include/functions.php – Kitabee</p>
<p>Fonctions utilitaires réutilisables dans tout le projet. Démarre la session si elle n'est pas déjà active.</p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a4fd21503bf97fbd3368faf9e9863a0e6" name="a4fd21503bf97fbd3368faf9e9863a0e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fd21503bf97fbd3368faf9e9863a0e6">&#9670;&#160;</a></span>kb_get_and_update_last_visit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_and_update_last_visit </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>$allowNonEssential</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Récupère et/ou met à jour la "dernière visite" selon le consentement cookies.</p>
<ul>
<li>Si non essentiels acceptés : met à jour cookie last_visit et renvoie la date actuelle.</li>
<li>Sinon : renvoie la valeur existante si présente.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$allowNonEssential</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string|null </dd></dl>

</div>
</div>
<a id="a2babe6c8d6d33fb668757af157dc0b0c" name="a2babe6c8d6d33fb668757af157dc0b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2babe6c8d6d33fb668757af157dc0b0c">&#9670;&#160;</a></span>kb_get_current_style()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_current_style </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retourne le thème courant (jour/nuit) depuis cookie, par défaut "jour".</p>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

</div>
</div>
<a id="a2456647f250fd8e5f13c9951e2a6d50e" name="a2456647f250fd8e5f13c9951e2a6d50e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2456647f250fd8e5f13c9951e2a6d50e">&#9670;&#160;</a></span>kb_get_logged_has_avatar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_logged_has_avatar </td>
          <td>(</td>
          <td class="paramtype">?PDO</td>          <td class="paramname"><span class="paramname"><em>$pdo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int</td>          <td class="paramname"><span class="paramname"><em>$loggedUserId</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Détermine si l'utilisateur connecté a choisi un avatar (avatar_choice). Synchronise aussi la session avatar_has (optionnel conseillé).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO&#160;|&#160;null</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$loggedUserId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool </dd></dl>

</div>
</div>
<a id="a6eb662ac89f0864d0a0308bd9da89021" name="a6eb662ac89f0864d0a0308bd9da89021"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eb662ac89f0864d0a0308bd9da89021">&#9670;&#160;</a></span>kb_get_logged_user_from_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_logged_user_from_session </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Récupère l'utilisateur connecté depuis la session.</p>
<dl class="section return"><dt>Returns</dt><dd>array{userId:int|null, login:string|null} </dd></dl>

</div>
</div>
<a id="a91e16f2d2bf74fc4096cbb9c04271437" name="a91e16f2d2bf74fc4096cbb9c04271437"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91e16f2d2bf74fc4096cbb9c04271437">&#9670;&#160;</a></span>kb_get_pending_club_notifications()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_pending_club_notifications </td>
          <td>(</td>
          <td class="paramtype">?PDO</td>          <td class="paramname"><span class="paramname"><em>$pdo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int</td>          <td class="paramname"><span class="paramname"><em>$loggedUserId</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Récupère le nombre de notifications de clubs non lues :</p><ul>
<li>invitations (club_invite)</li>
<li>messages (club_message)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO&#160;|&#160;null</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$loggedUserId</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array{pendingClubInvites:int, pendingClubMessages:int} </dd></dl>

</div>
</div>
<a id="a2cacb8629fc207f9c5636049d6c4e711" name="a2cacb8629fc207f9c5636049d6c4e711"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cacb8629fc207f9c5636049d6c4e711">&#9670;&#160;</a></span>kb_get_pending_friend_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_pending_friend_requests </td>
          <td>(</td>
          <td class="paramtype">?PDO</td>          <td class="paramname"><span class="paramname"><em>$pdo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int</td>          <td class="paramname"><span class="paramname"><em>$loggedUserId</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$pendingFriendRequests</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Récupère le nombre de demandes d'amis en attente. Si $pendingFriendRequests est déjà fourni (ex: depuis une page), on le respecte. Sinon, on calcule en base.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO&#160;|&#160;null</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$loggedUserId</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$pendingFriendRequests</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int </dd></dl>

</div>
</div>
<a id="a5bec22e721208dd4840b3c62eb81000c" name="a5bec22e721208dd4840b3c62eb81000c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bec22e721208dd4840b3c62eb81000c">&#9670;&#160;</a></span>kb_get_total_notifications()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_get_total_notifications </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$pendingFriendRequests</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$pendingClubInvites</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$pendingClubMessages</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calcule le total de notifications (amis + clubs).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$pendingFriendRequests</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$pendingClubInvites</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$pendingClubMessages</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int </dd></dl>

</div>
</div>
<a id="a94bb27f0b93cb26b22a4107882ec2872" name="a94bb27f0b93cb26b22a4107882ec2872"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94bb27f0b93cb26b22a4107882ec2872">&#9670;&#160;</a></span>kb_handle_style_toggle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_handle_style_toggle </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$style</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>$allowNonEssential</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Applique le toggle du thème.</p>
<ul>
<li>Met à jour la variable $style.</li>
<li>Si cookies non essentiels autorisés : enregistre le cookie "style" puis redirige pour éviter le resubmit du POST.</li>
<li>Si cookies non essentiels refusés : ne pose pas le cookie mais la variable $style change pour le rendu de la page.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$style</td><td></td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$allowNonEssential</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string Nouveau style appliqué </dd></dl>

</div>
</div>
<a id="a8ebf4bdde470f5bdc5acb3a8401b5115" name="a8ebf4bdde470f5bdc5acb3a8401b5115"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ebf4bdde470f5bdc5acb3a8401b5115">&#9670;&#160;</a></span>kb_header_bootstrap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_header_bootstrap </td>
          <td>(</td>
          <td class="paramtype">?PDO</td>          <td class="paramname"><span class="paramname"><em>$pdo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">?int</td>          <td class="paramname"><span class="paramname"><em>$pendingFriendRequests</em></span><span class="paramdefsep"> = </span><span class="paramdefval">null</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prépare toutes les variables nécessaires au header.</p>
<p>Retourne un tableau associatif contenant :</p><ul>
<li>loggedUserId, loggedLogin, loggedHasAvatar</li>
<li>pendingFriendRequests, pendingClubInvites, pendingClubMessages, totalNotifs</li>
<li>allowNonEssential, style, last_visit</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">PDO&#160;|&#160;null</td><td class="paramname">$pdo</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$pendingFriendRequests</td><td>Optionnel : si la page a déjà calculé ce compteur. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array&lt;string, mixed&gt; </dd></dl>

</div>
</div>
<a id="a1785699b363dcc64f09c95c70fadc299" name="a1785699b363dcc64f09c95c70fadc299"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1785699b363dcc64f09c95c70fadc299">&#9670;&#160;</a></span>kb_is_post_toggle_style()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kb_is_post_toggle_style </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Détecte si on est sur un POST de toggle du thème.</p>
<dl class="section return"><dt>Returns</dt><dd>bool </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a href="functions_8inc_8php.html">functions.inc.php</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
